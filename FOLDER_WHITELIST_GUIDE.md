# 文件夹白名单功能使用指南

## 功能概述
文件夹白名单功能允许用户选择性地扫描特定文件夹中的音乐文件，而不是扫描整个设备的音乐库。这可以大大提高音乐扫描速度，并避免扫描不需要的文件夹。

## 如何使用

### 1. 打开设置页面
- 启动应用后，点击底部导航栏的"更多"选项
- 在更多页面中，点击"设置"

### 2. 进入文件夹白名单设置
- 在设置页面中，找到"文件夹白名单"选项
- 点击进入文件夹白名单设置页面

### 3. 配置白名单
在文件夹白名单页面，你可以：

#### 选择要包含的文件夹
- 列表会显示所有检测到的音乐文件夹
- 每个文件夹前面有一个复选框
- 勾选复选框表示包含该文件夹
- 取消勾选表示排除该文件夹

#### 快速操作
- **全选**: 点击右上角的菜单按钮，选择"全选"来包含所有文件夹
- **取消全选**: 点击"取消全选"来排除所有文件夹
- **恢复默认**: 点击"恢复默认"将所有文件夹设为包含状态

#### 实时预览
- 文件夹列表会显示每个文件夹中的音乐文件数量
- 支持按文件夹名称排序
- 提供搜索功能快速定位文件夹

#### 保存设置
- 修改完成后，点击右上角的"保存"按钮
- 设置会立即生效，下次扫描音乐库时应用新的白名单规则

### 4. 重新扫描音乐库
- 返回设置页面
- 点击"扫描音乐库"来重新扫描音乐文件
- 只有白名单中的文件夹会被扫描
- 扫描进度会实时显示

## 注意事项

1. **默认行为**: 默认情况下，所有文件夹都被包含在白名单中
2. **实时生效**: 白名单设置保存后立即生效，无需重启应用
3. **路径格式**: 系统支持Windows和Unix路径格式
4. **权限要求**: 需要授予文件访问权限才能显示文件夹列表
5. **性能优化**: 白名单功能可以显著减少扫描时间，特别是对于大型存储设备

## 故障排除

### 文件夹列表为空
- 确保已授予文件访问权限
- 确认设备中确实存在音乐文件
- 检查是否已扫描过音乐库
- 尝试手动触发重新扫描

### 设置未生效
- 确认已点击"保存"按钮
- 尝试重新扫描音乐库
- 检查应用是否有存储权限
- 清除应用缓存后重试

### 扫描结果不准确
- 检查文件夹权限是否包含子文件夹
- 确认音频文件格式是否受支持
- 检查是否有隐藏文件夹被排除

## 技术实现

文件夹白名单功能通过以下组件实现：

- **SettingsService**: 管理白名单设置的存储和读取
- **MusicService**: 在扫描音乐时应用白名单过滤
- **FolderWhitelistPage**: 提供用户界面进行设置
- **PermissionHelper**: 处理文件夹访问权限

### 数据存储
- 白名单数据使用SharedPreferences存储，支持持久化保存用户设置
- 采用JSON格式存储文件夹路径和状态
- 支持导入/导出白名单配置

### 性能特点
- 增量扫描：只扫描白名单中的文件夹
- 缓存机制：缓存文件夹结构提高响应速度
- 异步处理：扫描过程不会阻塞UI线程

## 高级用法

### 批量管理
- 支持批量选择/取消选择文件夹
- 提供文件夹分组功能
- 支持按文件类型筛选文件夹

### 导入/导出
- 支持导出白名单配置为JSON文件
- 支持从JSON文件导入配置
- 便于用户备份和分享配置